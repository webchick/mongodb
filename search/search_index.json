{
    "docs": [
        {
            "location": "/", 
            "text": "MongoDB suite for Drupal\n\n\nThe MongoDB suite for Drupal 8 is a set of modules enabling the storage of\nvarious types of data on a Drupal\n site in MongoDB\n. This comes in\naddition to the standard SQL storage used by Drupal.\n\n\nIt comprises several Drupal modules, each implementing a specific functionality.\nWith the exception of the base \nmongodb\n module, upon which all others depend\nbecause it provides the standardized connection service to Drupal, all the\nmodules are independent of each other except where indicated.\n\n\nThe \nmongodb\n module is not just the basis for this package: it is also\ndesigned to ease the development of bespoke code for end-user projects,\nproviding Drupal-integrated Symfony\n services for Client and Database with a\nfamiliar alias-based selection, like those provided by Drupal core for the SQL\ndatabase drivers.\n\n\nModules\n\n\nExisting\n\n\n\n\n\n\n\n\nModule\n\n\nIn a word\n\n\nInformation\n\n\n\n\n\n\n\n\n\n\nmongodb\n\n\ndriver\n\n\nClient and Database services, \ntests\n base\n\n\n\n\n\n\nmongodb_storage\n\n\nkey-value\n\n\nKey-value store, with server-side expiration\n\n\n\n\n\n\nmongodb_watchdog\n\n\nlogger\n\n\nPSR-3 compliant logger with a built-in UI\n\n\n\n\n\n\n\n\nPlanned\n\n\nModules expected to be ported to 8.x-2.x in some release after 2.0 include:\n\n\n\n\n\n\n\n\nModule\n\n\nIn a word\n\n\nInformation\n\n\n\n\n\n\n\n\n\n\nmongodb_cache\n\n\ncache\n\n\nCache storage, with server-side expiration\n\n\n\n\n\n\nmongodb_lock\n\n\nlock\n\n\nLock plugin\n\n\n\n\n\n\nmongodb_path\n\n\npath\n\n\nPath plugin\n\n\n\n\n\n\n\n\nFuture directions\n\n\nThis module has no direct equivalent in earlier versions, but its development\nis being considered.\n\n\n\n\n\n\n\n\nModule\n\n\nInformation\n\n\n\n\n\n\n\n\n\n\nmongodb_debug\n\n\nProvides low-level debug information.\n\n\n\n\n\n\n\n\nA D7 version exists on \nmongodb_logger\n but depends on the legacy \nmongo\n PHP\nextension. Futures versions will need the 1.4 version of the \nmongodb\n extension\nwhich implements the MongoDB \nAPM specification\n.\n\n\nLegal information\n\n\n\n\nThis suite of modules is licensed under the General Public License,\n  v2.0 or later (GPL-2.0-or-later).\n\n\nMongoDB is a registered trademark of MongoDB Inc.\n\n\nDrupal is a registered trademark of Dries Buytaert.\n\n\nSymfony is a registered trademark of Symfony SAS.", 
            "title": "Home"
        }, 
        {
            "location": "/#mongodb-suite-for-drupal", 
            "text": "The MongoDB suite for Drupal 8 is a set of modules enabling the storage of\nvarious types of data on a Drupal  site in MongoDB . This comes in\naddition to the standard SQL storage used by Drupal.  It comprises several Drupal modules, each implementing a specific functionality.\nWith the exception of the base  mongodb  module, upon which all others depend\nbecause it provides the standardized connection service to Drupal, all the\nmodules are independent of each other except where indicated.  The  mongodb  module is not just the basis for this package: it is also\ndesigned to ease the development of bespoke code for end-user projects,\nproviding Drupal-integrated Symfony  services for Client and Database with a\nfamiliar alias-based selection, like those provided by Drupal core for the SQL\ndatabase drivers.", 
            "title": "MongoDB suite for Drupal"
        }, 
        {
            "location": "/#modules", 
            "text": "", 
            "title": "Modules"
        }, 
        {
            "location": "/#existing", 
            "text": "Module  In a word  Information      mongodb  driver  Client and Database services,  tests  base    mongodb_storage  key-value  Key-value store, with server-side expiration    mongodb_watchdog  logger  PSR-3 compliant logger with a built-in UI", 
            "title": "Existing"
        }, 
        {
            "location": "/#planned", 
            "text": "Modules expected to be ported to 8.x-2.x in some release after 2.0 include:     Module  In a word  Information      mongodb_cache  cache  Cache storage, with server-side expiration    mongodb_lock  lock  Lock plugin    mongodb_path  path  Path plugin", 
            "title": "Planned"
        }, 
        {
            "location": "/#future-directions", 
            "text": "This module has no direct equivalent in earlier versions, but its development\nis being considered.     Module  Information      mongodb_debug  Provides low-level debug information.     A D7 version exists on  mongodb_logger  but depends on the legacy  mongo  PHP\nextension. Futures versions will need the 1.4 version of the  mongodb  extension\nwhich implements the MongoDB  APM specification .", 
            "title": "Future directions"
        }, 
        {
            "location": "/#legal-information", 
            "text": "This suite of modules is licensed under the General Public License,\n  v2.0 or later (GPL-2.0-or-later).  MongoDB is a registered trademark of MongoDB Inc.  Drupal is a registered trademark of Dries Buytaert.  Symfony is a registered trademark of Symfony SAS.", 
            "title": "Legal information"
        }, 
        {
            "location": "/install/", 
            "text": "Installation and Settings\n\n\nPrerequisites\n\n\nThe MongoDB module and sub-modules need some configuration to be useful. This\nguide assumes that :\n\n\n\n\nA \nMongoDB\n 3.0 to 4.0 server instance is already installed,\n  configured and available for connection from the Drupal instance.\n\n\nThe site will be running \nDrupal\n 8.6.x or 8.7.x, with \nDrush\n \n  9.x.\n\n\nThe \nmongodb\n (not \nmongo\n) PHP extension version 1.1.7 or\n  later is installed and configured.\n\n\nPHP is version 7.1.x to 7.2.x. PHP 7.3.x might work but is not tested: be sure\n  to \nreport any issue\n you could have with it.\n\n\nWe recommend \nusing Composer\n for installing this\n  module.\n\n\n\n\nCheck out the \nMongoDB extension and library for PHP\n\n\nInstalling MongoDB itself is best explained in these official resources\nmaintained by MongoDB Inc.:\n\n\n\n\nMongoDB Mac installation\n\n\nMongoDB LINUX installation\n\n\nMongoDB Windows installation\n\n\n\n\nIf MongoDB 3.0 to 3.5\n1\n is installed on \nlocalhost:27017\n and the \nmongod\n\nserver was started with the \n\u2013httpinterface\n option, you may view the web admin\ninterface:\n\n\nhttp://localhost:28017/\n\n\n\nSettings Configuration\n\n\n\n\nDownload the module package, as per \n  \nInstalling contributed modules (Drupal 8)\n\n\nCopy the relevant section from \nmongodb/example.settings.local.php\n to your\n  \nsettings.local.php\n file if you use one, or \nsettings.php\n otherwise,\n  and adapt it to match your MongoDB settings. These settings are used by the\n  \nmongodb\n module to connect to your MongoDB servers, with the \ndefault\n server\n  being the one started in previous steps.\n\n\nThe \nclients\n key contains an associative array of connection by\n    connection alias, with the default connection parameters being under the\n    \ndefault\n key, and additional keys allowing the use of other\n    servers/clusters.\n\n\nThe \ndatabases\n key contains an associative array of server/database pairs\n    by database alias, with the default Drupal database being under the\n    \ndefault\n key, and additional keys allowing modules to use their own\n    database to avoid stepping on each other's toes. This is especially useful\n    for bespoke modules created for the needs of a specific site, which can thus\n    use their own databases, possibly located on other MongoDB clusters.\n    For example, with the following settings:\n\n\n\n\n// In sites/default/settings.local.php.\n$settings['mongodb'] = [\n  'clients' =\n [\n    // Client alias =\n connection constructor parameters.\n    'default' =\n [\n      'uri' =\n 'mongodb://localhost:27017',\n      'uriOptions' =\n [],\n      'driverOptions' =\n [],\n    ],\n  ],\n  'databases' =\n [\n    // Database alias =\n [ client_alias, database_name ]\n    'default' =\n ['default', 'drupal'],\n    'keyvalue' =\n ['default', 'keyvalue'],\n    'logger' =\n ['default', 'logger'],\n  ],\n];\n\n\n\n\n\n\nWith these settings:\n\n\nThe \ndefault\n database alias will handle collections in the \ndrupal\n\n  database on the \ndefault\n MongoDB server installed in earlier steps.\n\n\nThe \nkeyvalue\n database alias will store key-value collections on the\n  same \ndefault\n MongoDB server, but in a separate \nkeyvalue\n database.\n\n\nThe \nlogger\n database alias will store logger collections on the same\n  \ndefault\n MongoDB server, but in a separate \nlogger\n database.\n\n\n\n\n\n\n\n\nOnce the module is installed and enabled, you can check its requirements on\n\n/admin/reports/status\n:\n\n\n\n\nInstalling using Composer\n\n\nIf you are already using \nComposer\n in your site to manage module\ndependencies, installing is just a two-steps process:\n\n\n\n\n\n\nAt the root of your site, add this package:\n\n\n composer require \"drupal/mongodb:^2.0.0\"\n\n\n\n\n\n\n\nEnable the \nmongodb\n module. You now have access to the MongoDB services and\n  Drush/Console commands for the \nmongodb\n module.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nThis option is \ndeprecated from 3.6 version\n.", 
            "title": "Installation"
        }, 
        {
            "location": "/install/#installation-and-settings", 
            "text": "", 
            "title": "Installation and Settings"
        }, 
        {
            "location": "/install/#prerequisites", 
            "text": "The MongoDB module and sub-modules need some configuration to be useful. This\nguide assumes that :   A  MongoDB  3.0 to 4.0 server instance is already installed,\n  configured and available for connection from the Drupal instance.  The site will be running  Drupal  8.6.x or 8.7.x, with  Drush  \n  9.x.  The  mongodb  (not  mongo ) PHP extension version 1.1.7 or\n  later is installed and configured.  PHP is version 7.1.x to 7.2.x. PHP 7.3.x might work but is not tested: be sure\n  to  report any issue  you could have with it.  We recommend  using Composer  for installing this\n  module.   Check out the  MongoDB extension and library for PHP  Installing MongoDB itself is best explained in these official resources\nmaintained by MongoDB Inc.:   MongoDB Mac installation  MongoDB LINUX installation  MongoDB Windows installation   If MongoDB 3.0 to 3.5 1  is installed on  localhost:27017  and the  mongod \nserver was started with the  \u2013httpinterface  option, you may view the web admin\ninterface:  http://localhost:28017/", 
            "title": "Prerequisites"
        }, 
        {
            "location": "/install/#settings-configuration", 
            "text": "Download the module package, as per \n   Installing contributed modules (Drupal 8)  Copy the relevant section from  mongodb/example.settings.local.php  to your\n   settings.local.php  file if you use one, or  settings.php  otherwise,\n  and adapt it to match your MongoDB settings. These settings are used by the\n   mongodb  module to connect to your MongoDB servers, with the  default  server\n  being the one started in previous steps.  The  clients  key contains an associative array of connection by\n    connection alias, with the default connection parameters being under the\n     default  key, and additional keys allowing the use of other\n    servers/clusters.  The  databases  key contains an associative array of server/database pairs\n    by database alias, with the default Drupal database being under the\n     default  key, and additional keys allowing modules to use their own\n    database to avoid stepping on each other's toes. This is especially useful\n    for bespoke modules created for the needs of a specific site, which can thus\n    use their own databases, possibly located on other MongoDB clusters.\n    For example, with the following settings:   // In sites/default/settings.local.php.\n$settings['mongodb'] = [\n  'clients' =  [\n    // Client alias =  connection constructor parameters.\n    'default' =  [\n      'uri' =  'mongodb://localhost:27017',\n      'uriOptions' =  [],\n      'driverOptions' =  [],\n    ],\n  ],\n  'databases' =  [\n    // Database alias =  [ client_alias, database_name ]\n    'default' =  ['default', 'drupal'],\n    'keyvalue' =  ['default', 'keyvalue'],\n    'logger' =  ['default', 'logger'],\n  ],\n];   With these settings:  The  default  database alias will handle collections in the  drupal \n  database on the  default  MongoDB server installed in earlier steps.  The  keyvalue  database alias will store key-value collections on the\n  same  default  MongoDB server, but in a separate  keyvalue  database.  The  logger  database alias will store logger collections on the same\n   default  MongoDB server, but in a separate  logger  database.     Once the module is installed and enabled, you can check its requirements on /admin/reports/status :", 
            "title": "Settings Configuration"
        }, 
        {
            "location": "/install/#installing-using-composer", 
            "text": "If you are already using  Composer  in your site to manage module\ndependencies, installing is just a two-steps process:    At the root of your site, add this package:   composer require \"drupal/mongodb:^2.0.0\"    Enable the  mongodb  module. You now have access to the MongoDB services and\n  Drush/Console commands for the  mongodb  module.        This option is  deprecated from 3.6 version .", 
            "title": "Installing using Composer"
        }, 
        {
            "location": "/layout/", 
            "text": "Project layout\n\n\n.coveralls.yml             # Code coverage configuration file\n.scrutinizer.yml           # Scrutinizer configuration file\n.gitignore                 # Git ignore file\n.travis.yml                # Travis build configuration  file\nREADME.md                  # Current Readme file\ncomposer.json              # Composer configuration file\ncore.phpunit.xml           # PHPUnit configuration file\ndocs/\n    index.md               # The documentation homepage.\n    ...                    # Other markdown pages, images and other files\nexample.settings.local.php # Example settings to connect to MongoDB\nmkdocs.yml                 # The Mkdocs configuration file\nmodules/                   # \n    mongodb                # Driver\n    mongodb_storage        # Key-value\n    mongodb_watchdog       # Logger", 
            "title": "Layout"
        }, 
        {
            "location": "/layout/#project-layout", 
            "text": ".coveralls.yml             # Code coverage configuration file\n.scrutinizer.yml           # Scrutinizer configuration file\n.gitignore                 # Git ignore file\n.travis.yml                # Travis build configuration  file\nREADME.md                  # Current Readme file\ncomposer.json              # Composer configuration file\ncore.phpunit.xml           # PHPUnit configuration file\ndocs/\n    index.md               # The documentation homepage.\n    ...                    # Other markdown pages, images and other files\nexample.settings.local.php # Example settings to connect to MongoDB\nmkdocs.yml                 # The Mkdocs configuration file\nmodules/                   # \n    mongodb                # Driver\n    mongodb_storage        # Key-value\n    mongodb_watchdog       # Logger", 
            "title": "Project layout"
        }, 
        {
            "location": "/modules/mongodb/", 
            "text": "Driver: \nmongodb\n\n\nThe \nmongodb\n module is the main module in the suite, providing a thin Drupal\nadapter for the standard MongoDB PHP library, in the form of two Symfony factory\nservices and a base test class.\n\n\nFactories\n\n\nThe basic idea of these factory services is to provide a way to create\ninstances of the standard MongoDB \nClient\n and \nDatabase\n classes from a simple\nalias string, taking all properties from the Drupal standard \nSettings\n object.\n\n\nThis allows code to be unaware of the execution environment, referring to\ndatabase or client by a functional alias, while the specifics of accessing\nthe relevant \nmongod\n/\nmongos\n and database are left to per-environment\nsettings,\n\n\n\n\nDrupal\\mongodb\\DatabaseFactory\n : The recommended entry point for most\n  applications, returning a \nMongoDb\\Database\n from an alias string.\n\n\n__construct(ClientFactory $clientFactory, Settings $settings)\n. This is\n  normally invoked by the container, to which the class is exposed as the\n  \nmongodb.database_factory\n service.\n\n\nget(string $dbAlias): MongoDb\\Database\n; returns a \nDatabase\n instance\n  matching the value defined in Drupal settings for \n$dbAlias\n.\n\n\n\n\n\n\nDrupal\\mongodb\\ClientFactory\n: This one may be needed for more complex\n  applications, e.g. those wishing to handle operations spanning connections\n  to multiple MongoDB replica sets/sharded clusters.\n\n\n__construct(Settings $settings)\n. This is normally invoked by the\n  container, to which the class is exposed as the \nmongodb.client_factory\n\n  service.\n\n\nget(string $alias): MongoDb\\Client\n: returns a \nClient\n instance matching\n  the value defined in Drupal settings for \n$alias\n.\n\n\n\n\n\n\n\n\nTroubleshooting commands:\n\n\nThe module provides two commands designed to help troubleshoot issues and access\nthe contents of the MongoDB databases. Both are available for Drush and Drupal\nConsole indifferently.\n\n\n\n\n\n\ndrush mongodb:settings\n reports how the module suite sees the settings. It\n  needs no parameters, and returns YAML output looking like this:\n\n\nclients:\n  default:\n    uri: 'mongodb://localhost:27017'\n    uriOptions: {  }\n    driverOptions: {  }\ndatabases:\n  default:\n    - default\n    - drupal\n  keyvalue:\n    - default\n    - keyvalue\n  logger:\n    - default\n\n\n\n\n\n\n\ndrush mongodb:find \ndb_alias\n \ncollection\n \nselector\n allows running a\n  MongoDB query from the command line on the chosen database alias and\n  collection, returning the results as YAML, as in the following example. Note\n  that passing JSON selectors from the \nbash\n command lines requires escaping as\n  in that example:\n\n\n$ drush mongodb:find keyvalue kvp_state '{ \"_id\": \"node.min_max_update_time\" }'\n-\n  _id: node.min_max_update_time\n  value: 'a:2:{s:11:\"min_created\";N;s:11:\"max_created\";N;}'$\n$\n\n\n\n\n\n\n\nTest base class\n\n\nThe module provides a \n\\Drupal\\Tests\\mongodb\\Kernel\\MongoDbTestBase\n extending\ncore class \nKernelTestBase\n. This allows modules to define their own integration\ntests using the module services, and taking advantage of running in a per-test\ndatabase. What it actually provides:\n\n\n\n\nTest instance properties:\n\n\n$this-\nuri\n contains a MongoDB URI suitable for connecting to a default\nclient, taken from the value of the \nMONGODB_URI\n variable is passed in the\nenvironment, on the PHPUnit command line, or in the \nphpunit.xml\n\nconfiguration file, this will be its value, otherwise it will be set to the\ntraditional MongoDB default instance: \nmongodb://localhost:27017\n.\n\n\n$this-\nsettings\n contains a test-specific instance of core \nSettings\n,\nlimited to the \nmongodb\n settings key. The default database in these\nsettings is a temporary database defined by the Simpletest prefix, allowing\nit to be used without interacting with the rest of the site, and dropped\nduring test teardown.\n\n\n\n\n\n\nConstants: in addition to the ones used by the \nmongodb\n tests, the base test\n  defines constants usable by child tests:\n\n\nCLIENT_TEST_ALIAS\n is the alias for the default MongoDB test client\n\n\nDB_DEFAULT_ALIAS\n is the alias for the default test database\n\n\n\n\n\n\nModules:\n\n\nThe test base enables the \nmongodb\n modules, since all modules using\n  MongoDB are expected to depend on it.\n\n\nModule tests will typically want their own module enabled, so they will\n  need to redefine \nstatic::$modules\n including the \nmongodb\n module as done\n  in \nDrupal\\Tests\\mongodb_storage\\Kernel\\KeyValueTestBase\n and\n  \nDrupal\\Tests\\mongodb_watchdog\\Kernel\\LoggerTest\n.\n\n\n\n\n\n\nsetUp()\n / \ntearDown()\n:\n\n\nTests need to invoke \nparent::setUp()\n near the top of their own\n  \nsetUp()\n, to have the test base define the properties before doing their\n  own work.\n\n\nTests need to invoke \nparent::tearDown()\n near the end of their own\n  \ntearDown()\n - if any - to drop the default test database.\n\n\nTests needing non-default test databases need to override the\n  \ngetSettingsArray()\n function to add their own database alias after\n  invoking \nparent::setUp()\n, and need to drop that database during their\n  own \ntearDown()\n.\n\n\nThey can use \n$this-\ngetTestDatabaseName($postfix)\n method to build a\n  per-test database name that will not collide with the default \n  database.\n\n\nThere are examples for this in the \nmongodb_watchdoig\n tests.\n\n\n\n\n\n\n\n\n\n\n\n\nA complete example of how to write a test using that base class is given on the\n\ntests\n page.", 
            "title": "Driver: mongodb"
        }, 
        {
            "location": "/modules/mongodb/#driver-mongodb", 
            "text": "The  mongodb  module is the main module in the suite, providing a thin Drupal\nadapter for the standard MongoDB PHP library, in the form of two Symfony factory\nservices and a base test class.", 
            "title": "Driver: mongodb"
        }, 
        {
            "location": "/modules/mongodb/#factories", 
            "text": "The basic idea of these factory services is to provide a way to create\ninstances of the standard MongoDB  Client  and  Database  classes from a simple\nalias string, taking all properties from the Drupal standard  Settings  object.  This allows code to be unaware of the execution environment, referring to\ndatabase or client by a functional alias, while the specifics of accessing\nthe relevant  mongod / mongos  and database are left to per-environment\nsettings,   Drupal\\mongodb\\DatabaseFactory  : The recommended entry point for most\n  applications, returning a  MongoDb\\Database  from an alias string.  __construct(ClientFactory $clientFactory, Settings $settings) . This is\n  normally invoked by the container, to which the class is exposed as the\n   mongodb.database_factory  service.  get(string $dbAlias): MongoDb\\Database ; returns a  Database  instance\n  matching the value defined in Drupal settings for  $dbAlias .    Drupal\\mongodb\\ClientFactory : This one may be needed for more complex\n  applications, e.g. those wishing to handle operations spanning connections\n  to multiple MongoDB replica sets/sharded clusters.  __construct(Settings $settings) . This is normally invoked by the\n  container, to which the class is exposed as the  mongodb.client_factory \n  service.  get(string $alias): MongoDb\\Client : returns a  Client  instance matching\n  the value defined in Drupal settings for  $alias .", 
            "title": "Factories"
        }, 
        {
            "location": "/modules/mongodb/#troubleshooting-commands", 
            "text": "The module provides two commands designed to help troubleshoot issues and access\nthe contents of the MongoDB databases. Both are available for Drush and Drupal\nConsole indifferently.    drush mongodb:settings  reports how the module suite sees the settings. It\n  needs no parameters, and returns YAML output looking like this:  clients:\n  default:\n    uri: 'mongodb://localhost:27017'\n    uriOptions: {  }\n    driverOptions: {  }\ndatabases:\n  default:\n    - default\n    - drupal\n  keyvalue:\n    - default\n    - keyvalue\n  logger:\n    - default    drush mongodb:find  db_alias   collection   selector  allows running a\n  MongoDB query from the command line on the chosen database alias and\n  collection, returning the results as YAML, as in the following example. Note\n  that passing JSON selectors from the  bash  command lines requires escaping as\n  in that example:  $ drush mongodb:find keyvalue kvp_state '{ \"_id\": \"node.min_max_update_time\" }'\n-\n  _id: node.min_max_update_time\n  value: 'a:2:{s:11:\"min_created\";N;s:11:\"max_created\";N;}'$\n$", 
            "title": "Troubleshooting commands:"
        }, 
        {
            "location": "/modules/mongodb/#test-base-class", 
            "text": "The module provides a  \\Drupal\\Tests\\mongodb\\Kernel\\MongoDbTestBase  extending\ncore class  KernelTestBase . This allows modules to define their own integration\ntests using the module services, and taking advantage of running in a per-test\ndatabase. What it actually provides:   Test instance properties:  $this- uri  contains a MongoDB URI suitable for connecting to a default\nclient, taken from the value of the  MONGODB_URI  variable is passed in the\nenvironment, on the PHPUnit command line, or in the  phpunit.xml \nconfiguration file, this will be its value, otherwise it will be set to the\ntraditional MongoDB default instance:  mongodb://localhost:27017 .  $this- settings  contains a test-specific instance of core  Settings ,\nlimited to the  mongodb  settings key. The default database in these\nsettings is a temporary database defined by the Simpletest prefix, allowing\nit to be used without interacting with the rest of the site, and dropped\nduring test teardown.    Constants: in addition to the ones used by the  mongodb  tests, the base test\n  defines constants usable by child tests:  CLIENT_TEST_ALIAS  is the alias for the default MongoDB test client  DB_DEFAULT_ALIAS  is the alias for the default test database    Modules:  The test base enables the  mongodb  modules, since all modules using\n  MongoDB are expected to depend on it.  Module tests will typically want their own module enabled, so they will\n  need to redefine  static::$modules  including the  mongodb  module as done\n  in  Drupal\\Tests\\mongodb_storage\\Kernel\\KeyValueTestBase  and\n   Drupal\\Tests\\mongodb_watchdog\\Kernel\\LoggerTest .    setUp()  /  tearDown() :  Tests need to invoke  parent::setUp()  near the top of their own\n   setUp() , to have the test base define the properties before doing their\n  own work.  Tests need to invoke  parent::tearDown()  near the end of their own\n   tearDown()  - if any - to drop the default test database.  Tests needing non-default test databases need to override the\n   getSettingsArray()  function to add their own database alias after\n  invoking  parent::setUp() , and need to drop that database during their\n  own  tearDown() .  They can use  $this- getTestDatabaseName($postfix)  method to build a\n  per-test database name that will not collide with the default \n  database.  There are examples for this in the  mongodb_watchdoig  tests.       A complete example of how to write a test using that base class is given on the tests  page.", 
            "title": "Test base class"
        }, 
        {
            "location": "/modules/mongodb_storage/", 
            "text": "Key-value: \nmongodb_storage\n\n\nThe \nmongodb_storage\n module implements the \nKey-Value storage\n\nfor Drupal in MongoDB.\n\n\nConfiguration\n\n\nTo use the MongoDB Key-Value (Expirable) storage:\n\n\n\n\nensure there is a \nkeyvalue\n database alias as in\n  \nsettings configuration\n.\n\n\n\n\ndeclare MongoDB as the default Key-Value storage implementation by editing\n  the existing declarations in the \nsites/default/services.yml\n file:\n\n\n# In sites/default/services.yml.\nfactory.keyvalue:\n  default: keyvalue.mongodb\nfactory.keyvalue.expirable:\n  keyvalue_expirable_default: keyvalue.expirable.mongodb\n\n\n\n\n\n\n\nenable the module, e.g. using \ndrush en mongodb_storage\n.\n\n\n\n\n\n\nimport the existing Key-Value contents from the database, using the Drush\n  or Console \nmongodb:storage:import_keyvalue\n command: \ndrush most-ikv\n. \n  It will output the names of the imported stores, for your information:\n\n\n  key_value\n  key_value_expire\n\n\n\n\n\n\n\nrebuild the container to take these changes into account using \ndrush cr\n.\n\n\n\n\n\n\nCommand\n\n\nThe module provides one single command to import the content of the default SQL\nstorage for Key-Value into MongoDB. The command is available for Drush and \nDrupal Console indifferently, and is described in the previous paragraph as part\nof the configuration steps.", 
            "title": "Key-value: mongodb_storage"
        }, 
        {
            "location": "/modules/mongodb_storage/#key-value-mongodb_storage", 
            "text": "The  mongodb_storage  module implements the  Key-Value storage \nfor Drupal in MongoDB.", 
            "title": "Key-value: mongodb_storage"
        }, 
        {
            "location": "/modules/mongodb_storage/#configuration", 
            "text": "To use the MongoDB Key-Value (Expirable) storage:   ensure there is a  keyvalue  database alias as in\n   settings configuration .   declare MongoDB as the default Key-Value storage implementation by editing\n  the existing declarations in the  sites/default/services.yml  file:  # In sites/default/services.yml.\nfactory.keyvalue:\n  default: keyvalue.mongodb\nfactory.keyvalue.expirable:\n  keyvalue_expirable_default: keyvalue.expirable.mongodb    enable the module, e.g. using  drush en mongodb_storage .    import the existing Key-Value contents from the database, using the Drush\n  or Console  mongodb:storage:import_keyvalue  command:  drush most-ikv . \n  It will output the names of the imported stores, for your information:    key_value\n  key_value_expire    rebuild the container to take these changes into account using  drush cr .", 
            "title": "Configuration"
        }, 
        {
            "location": "/modules/mongodb_storage/#command", 
            "text": "The module provides one single command to import the content of the default SQL\nstorage for Key-Value into MongoDB. The command is available for Drush and \nDrupal Console indifferently, and is described in the previous paragraph as part\nof the configuration steps.", 
            "title": "Command"
        }, 
        {
            "location": "/modules/mongodb_watchdog/", 
            "text": "Logger: \nmongodb_watchdog\n\n\nThe \nmongodb_watchdog\n module stores the log entries for your Drupal site\nin MongoDB collections as mentioned in\n\nSettings Configuration\n\n\nThis module uses a separate database, defined by the \nlogger\n database alias in\nsettings. Do NOT point that alias to the same database as \ndefault\n, because the\nmodule Drops the \nlogger\n database when uninstalling, which would drop all your\nother data with it.\n\n\nConfiguration\n\n\nBelow are the configurable items available in \nmongodb_watchdog.settings\n\n\n\n\nmongodb.watchdog.items\n\n\nthe maximum item limit on the capped collection used by the module.\n\n\nif not defined, it defaults to 10000.\n\n\nthe actual (size-based) limit is derived from this value, assuming\n  1\nkiB\n per watchdog entry.\n\n\n\n\n\n\nmongodb.watchdog.limit\n\n\nthe maximum severity level (0 to 7, per RFC 5424) to save into the logger\n  storage.\n\n\nevents below this level (with a higher numerical level) will be ignored by\n  the module.\n\n\nif not defined, all events will saved.\n\n\n\n\n\n\nmongodb.watchdog.items_per_page\n\n\nthe maximum number of events displayed on the event details page.\n\n\n\n\n\n\nmongodb_watchdog.request_tracking\n\n\nif true, enable the per-request event tracking.\n\n\nif not defined, it defaults to false because its cost is not entirely\n  negligible.\n\n\nthis feature requires the use of \nmod_unique_id\n in Apache 2.x\n\n\n\n\n\n\nmongodb_watchdog.requests\n\n\nif request tracking is enabled, this setting defines the maximum requests\n  limit on the capped collection used by the module.\n\n\nif not defined, it defaults to 100000.\n\n\nthe actual (size-based) limit is derived from this variable, assuming\n  1\nkiB\n per tracker entry.\n\n\n\n\n\n\n\n\nSee \nDrupal\\Core\\Logger\\RfcLogLevel\n and \nPsr\\Log\\LogLevel\n for further\ninformation about severity levels.\n\n\nTroubleshooting command\n\n\nThe module provides one single command designed to help troubleshoot issues with\nlogging when this module is enabled. It is available for Drush and Drupal\nConsole indifferently.\n\n\nThe command takes no arguments and returns an analysis of the logger collections\nwhich needs to be interpreted.\n\n\n$ drush mongodb:watchdog:sanitycheck\n0: 0\n1: 2\n1000: 1\n2000: 0\n3000: 0\n4000: 0\n5000: 0\n6000: 0\n7000: 0\n8000: 0\n9000: 0\n9999: 0\n10000: 0\n$\n\n\n\nWhat the output of this command represents is the number of \nwatchdog_event_*\n\ncollections with a document count in the range specified as the key.\n\n\nIn the results, the first and last two entries are specific: they match exact\ncounts, while the others are intervals, so the actual buckets are: \n0\n, \n1\n,\n\n2..1000\n, \n1001..2000\n, ..., \n9001..9998\n, \n9999\n, \n10000\n. The specific\nvalue 10000 is the number of entries allowed in event collections, as these are\nMongoDB capped collections: whatever its value \nn\n, the command will report \n\n0\n, \n1\n, \nn-1\n, \nn\n, and 9 ranges in between.\n\n\nInterpreting the results\n\n\nAs a general rule, on a high-load site, all buckets should have comparable\nnumbers, and the number of events logged grouped by pattern is pseudo-random,\nexcept for the \n0\n bucket, which should be empty.\n\n\n\n\n0\n bucket non-empty: unless there was specific manipulation performed by\n  hand, this is a bug, and should be reported: event collections are created\n  when an event is created, by the first insertion, and dropped as needed, but\n  never truncated or created without an insert.\n\n\n1\n bucket has a high value, possibly orders of magnitude higher than other\n  buckets. This denotes an incorrect use of the Drupal logger system, for which\n  the PSR-3 \nmessage\n parameter is a message template, and the variant part of\n  the message is expressed as placeholder values in the options. Look for calls\n  to log operations passing a variable as the message and replace them by a\n  template containing placeholders for the variable content in the message.\n\n\nn-1\n bucket has a high value: suspicious situation with the logger,\n  especially if the \"n\" value is low or 0: please report a possible bug, with\n  accompanying data\n\n\nn\n bucket has a high value\n\n\nn-1\n has a high value too: this is a mostly  normal situation,\n  especially if the value in the previous bucket is also high, although it\n  means the data rotation in your site is possibly a bit high and you should\n  increase the size of the capped collections to ensure longer retention of\n  data.\n\n\nn-1\n has a low or 0 value: your logs are saturated by the site, and you\n  are losing information, as all the capped collections in that situation\n  are rolling over constantly. Ensure you have enough storage and raise the\n  value capped collection size.\n\n\nThe config value to change in these cases is \nmongodb.watchdog.items\n.", 
            "title": "Logger: mongodb_watchdog"
        }, 
        {
            "location": "/modules/mongodb_watchdog/#logger-mongodb_watchdog", 
            "text": "The  mongodb_watchdog  module stores the log entries for your Drupal site\nin MongoDB collections as mentioned in Settings Configuration  This module uses a separate database, defined by the  logger  database alias in\nsettings. Do NOT point that alias to the same database as  default , because the\nmodule Drops the  logger  database when uninstalling, which would drop all your\nother data with it.", 
            "title": "Logger: mongodb_watchdog"
        }, 
        {
            "location": "/modules/mongodb_watchdog/#configuration", 
            "text": "Below are the configurable items available in  mongodb_watchdog.settings   mongodb.watchdog.items  the maximum item limit on the capped collection used by the module.  if not defined, it defaults to 10000.  the actual (size-based) limit is derived from this value, assuming\n  1 kiB  per watchdog entry.    mongodb.watchdog.limit  the maximum severity level (0 to 7, per RFC 5424) to save into the logger\n  storage.  events below this level (with a higher numerical level) will be ignored by\n  the module.  if not defined, all events will saved.    mongodb.watchdog.items_per_page  the maximum number of events displayed on the event details page.    mongodb_watchdog.request_tracking  if true, enable the per-request event tracking.  if not defined, it defaults to false because its cost is not entirely\n  negligible.  this feature requires the use of  mod_unique_id  in Apache 2.x    mongodb_watchdog.requests  if request tracking is enabled, this setting defines the maximum requests\n  limit on the capped collection used by the module.  if not defined, it defaults to 100000.  the actual (size-based) limit is derived from this variable, assuming\n  1 kiB  per tracker entry.     See  Drupal\\Core\\Logger\\RfcLogLevel  and  Psr\\Log\\LogLevel  for further\ninformation about severity levels.", 
            "title": "Configuration"
        }, 
        {
            "location": "/modules/mongodb_watchdog/#troubleshooting-command", 
            "text": "The module provides one single command designed to help troubleshoot issues with\nlogging when this module is enabled. It is available for Drush and Drupal\nConsole indifferently.  The command takes no arguments and returns an analysis of the logger collections\nwhich needs to be interpreted.  $ drush mongodb:watchdog:sanitycheck\n0: 0\n1: 2\n1000: 1\n2000: 0\n3000: 0\n4000: 0\n5000: 0\n6000: 0\n7000: 0\n8000: 0\n9000: 0\n9999: 0\n10000: 0\n$  What the output of this command represents is the number of  watchdog_event_* \ncollections with a document count in the range specified as the key.  In the results, the first and last two entries are specific: they match exact\ncounts, while the others are intervals, so the actual buckets are:  0 ,  1 , 2..1000 ,  1001..2000 , ...,  9001..9998 ,  9999 ,  10000 . The specific\nvalue 10000 is the number of entries allowed in event collections, as these are\nMongoDB capped collections: whatever its value  n , the command will report  0 ,  1 ,  n-1 ,  n , and 9 ranges in between.", 
            "title": "Troubleshooting command"
        }, 
        {
            "location": "/modules/mongodb_watchdog/#interpreting-the-results", 
            "text": "As a general rule, on a high-load site, all buckets should have comparable\nnumbers, and the number of events logged grouped by pattern is pseudo-random,\nexcept for the  0  bucket, which should be empty.   0  bucket non-empty: unless there was specific manipulation performed by\n  hand, this is a bug, and should be reported: event collections are created\n  when an event is created, by the first insertion, and dropped as needed, but\n  never truncated or created without an insert.  1  bucket has a high value, possibly orders of magnitude higher than other\n  buckets. This denotes an incorrect use of the Drupal logger system, for which\n  the PSR-3  message  parameter is a message template, and the variant part of\n  the message is expressed as placeholder values in the options. Look for calls\n  to log operations passing a variable as the message and replace them by a\n  template containing placeholders for the variable content in the message.  n-1  bucket has a high value: suspicious situation with the logger,\n  especially if the \"n\" value is low or 0: please report a possible bug, with\n  accompanying data  n  bucket has a high value  n-1  has a high value too: this is a mostly  normal situation,\n  especially if the value in the previous bucket is also high, although it\n  means the data rotation in your site is possibly a bit high and you should\n  increase the size of the capped collections to ensure longer retention of\n  data.  n-1  has a low or 0 value: your logs are saturated by the site, and you\n  are losing information, as all the capped collections in that situation\n  are rolling over constantly. Ensure you have enough storage and raise the\n  value capped collection size.  The config value to change in these cases is  mongodb.watchdog.items .", 
            "title": "Interpreting the results"
        }, 
        {
            "location": "/bespoke/", 
            "text": "Bespoke code\n\n\nBeyond the simple use cases covered by this standard package, most uses of\nMongoDB in Drupal projects appear in enteprise-class bespoke developments. Until\nthis version, this usually meant totally custom code, built either straight from\nthe legacy \nmongo\n extension, the current \nmongodb\n extension, or on top of the\nPHP Library or the Doctrine ODM for MongoDB, suffering from a total lack of\nintegration with the underlying core Drupal CMS.\n\n\nThis module provides a degree of version independence for the API changes in\n\nPHP library\n. Refer to the \nDrupal\\mongodb\\MongoDb\n class for an example.\n\n\nStarting with 8.x-2.0, such one-off code can be developed on top of the base\n\nmongodb\n module: unlike earlier releases, 8.x-2.x uses the PHP-standard\nconnection methods and options, without deviation, adding only a thin layer of\nDrupal adaptation on top of the standard \nmongodb\n \nextension\n and\n\nPHP library\n.\n\n\nExample\n\n\nThe familiar Drupal alias mechanism for databases is available to provide easy,\nstring-referenced access to \nClient\n and \nDatabase\n instances through the\npackage-provided \nClientFactory\n and \nDatabaseFactory\n services respectively.\n\n\nMost such code is likely to be service based, so the example given below\ndemonstrates a service \nbar\n in module \nfoo\n, using a custom \nfoo-database\n\ndatabase aliased as \nfoodb\n, to keep its storage separate from the main database\nused by the package modules, and its logic independent of other Drupal modules.\n\n\nPer-environment settings\n\n\nThe site local settings file includes the alias definition, binding it to the\nactual database credentials, allowing for per-environment configuration:\n\n\n?php\n// settings.local.php\n$settings['mongodb'] = [\n  'clients' =\n [\n    // Client alias =\n constructor parameters.\n    'default' =\n [\n      'uri' =\n 'mongodb://localhost:27017',\n      'uriOptions' =\n [],\n      'driverOptions' =\n [],\n    ],\n  ],\n  'databases' =\n [\n    // Collection alias =\n [ client_alias, collection_name ]\n    'default' =\n ['default', 'drupal'],\n    'logger' =\n ['default', 'logger'],\n    'foodb' =\n ['default', 'foo-database'],\n  ],\n];\n\n\n\nWith such a configuration, the \nfoodb\n alias is available to all MongoDB-using\nmodules in the site, possibly pointing to different databases depending on the\nenvironment (development, staging, production...).\n\n\nService-based module adapter\n\n\nThe \nfoo.services.yml\n service file for the bespoke \nfoo.module\n can then\nreference \nfoodb\n to access the database with a constant alias, regardless\nof the environment:\n\n\n// modules/custom/Foo/foo.services.yml\nservices:\n  foo.storage:\n    class: 'MongoDB\\Database'\n    factory: ['@mongodb.database_factory', 'get']\n    arguments: ['foodb']\n\n  foo.bar:\n    class: 'Drupal\\foo\\Bar'\n    arguments: ['@foo.storage', '@logger.channel.foo']\n\n  foo.baz:\n    class: 'Drupal\\foo\\Baz'\n    arguments: ['@foo.storage', '@mongodb.logger']\n\n\n\nThis allows services in the module to access the database in both function code\nfor Drupal hooks, and OO code for component-level logic without having to be\nenvironment-aware.\n\n\nIf the \nmongodb_watchdog\n module is enabled:\n\n\n\n\nthe \n@logger.channel.foo\n logger instance passed to the \nBar\n constructor will\n  be a Drupal-standard \nLoggerChannel\n instance, dispatching events to all\n  active loggers in the site. This is the service most \"classic\" Drupal\n  applications will want to use, as it has no visible dependence on MongoDB. .\n\n\nthe \n@mongodb.logger\n logger instance passed to the \nBaz\n constructor will be\n  a PSR-3-standard logger only writing to MongoDB instead of logging through the\n  central Drupal logging channel mechanism, but still providing the standard\n  Drupal UI to examine the application logs. When using this service, the \n  \ntype\n option MUST be set in the message context to appear as a logging\n  channel in the Drupal logs UI. This is the service applications written in a\n  \"decoupled components\" style will prefer.\n\n\nIn both cases, code receiving such a logger service by dependency injection\n  should type-hint it to the PSR-3 \nLoggerInterface\n.\n\n\n\n\nComponent logic\n\n\nFinally, the component application logic can use the services without receiving\nany Drupal-specific dependency. In this example, we can simply assume the\nservice code is located within the module itself, for simplicity:\n\n\n?php\n// modules/custom/Foo/src/Bar.php\nuse MongoDb\\Database;\nuse Psr\\Log\\LoggerInterface;\n\npublic function __construct(Database $database, LoggerInterface $logger) {\n  $this-\ndatabase = $database;\n  $this-\nlogger = $logger;\n}\n\npublic function baz() {\n  // Perform some business logic using $this-\ndatabase.\n  // Log it using $this-\nlogger.\n}\n\n\n\nHaving the code only receive standard services (like a PSR-3 logger) or\n\nPHP library\n classes allows it to be written as an agnostic component that can\nbe brought in using Composer and shared with non-Drupal code. This is often\nuseful in bespoke projects, which tend to combine Drupal with other parts of the\napplication written in Laravel 5 or Symfony 4, since the code has no\nDrupal-specific dependency in that case, only exposing a PSR-3 standard API.\n\n\nTests\n\n\nThe \nmongodb\n module provides a \nMongoDbTestBase\n base test class allowing\nkernel-based integration tests, as described on the \ntests\n page.", 
            "title": "Bespoke code"
        }, 
        {
            "location": "/bespoke/#bespoke-code", 
            "text": "Beyond the simple use cases covered by this standard package, most uses of\nMongoDB in Drupal projects appear in enteprise-class bespoke developments. Until\nthis version, this usually meant totally custom code, built either straight from\nthe legacy  mongo  extension, the current  mongodb  extension, or on top of the\nPHP Library or the Doctrine ODM for MongoDB, suffering from a total lack of\nintegration with the underlying core Drupal CMS.  This module provides a degree of version independence for the API changes in PHP library . Refer to the  Drupal\\mongodb\\MongoDb  class for an example.  Starting with 8.x-2.0, such one-off code can be developed on top of the base mongodb  module: unlike earlier releases, 8.x-2.x uses the PHP-standard\nconnection methods and options, without deviation, adding only a thin layer of\nDrupal adaptation on top of the standard  mongodb   extension  and PHP library .", 
            "title": "Bespoke code"
        }, 
        {
            "location": "/bespoke/#example", 
            "text": "The familiar Drupal alias mechanism for databases is available to provide easy,\nstring-referenced access to  Client  and  Database  instances through the\npackage-provided  ClientFactory  and  DatabaseFactory  services respectively.  Most such code is likely to be service based, so the example given below\ndemonstrates a service  bar  in module  foo , using a custom  foo-database \ndatabase aliased as  foodb , to keep its storage separate from the main database\nused by the package modules, and its logic independent of other Drupal modules.", 
            "title": "Example"
        }, 
        {
            "location": "/bespoke/#per-environment-settings", 
            "text": "The site local settings file includes the alias definition, binding it to the\nactual database credentials, allowing for per-environment configuration:  ?php\n// settings.local.php\n$settings['mongodb'] = [\n  'clients' =  [\n    // Client alias =  constructor parameters.\n    'default' =  [\n      'uri' =  'mongodb://localhost:27017',\n      'uriOptions' =  [],\n      'driverOptions' =  [],\n    ],\n  ],\n  'databases' =  [\n    // Collection alias =  [ client_alias, collection_name ]\n    'default' =  ['default', 'drupal'],\n    'logger' =  ['default', 'logger'],\n    'foodb' =  ['default', 'foo-database'],\n  ],\n];  With such a configuration, the  foodb  alias is available to all MongoDB-using\nmodules in the site, possibly pointing to different databases depending on the\nenvironment (development, staging, production...).", 
            "title": "Per-environment settings"
        }, 
        {
            "location": "/bespoke/#service-based-module-adapter", 
            "text": "The  foo.services.yml  service file for the bespoke  foo.module  can then\nreference  foodb  to access the database with a constant alias, regardless\nof the environment:  // modules/custom/Foo/foo.services.yml\nservices:\n  foo.storage:\n    class: 'MongoDB\\Database'\n    factory: ['@mongodb.database_factory', 'get']\n    arguments: ['foodb']\n\n  foo.bar:\n    class: 'Drupal\\foo\\Bar'\n    arguments: ['@foo.storage', '@logger.channel.foo']\n\n  foo.baz:\n    class: 'Drupal\\foo\\Baz'\n    arguments: ['@foo.storage', '@mongodb.logger']  This allows services in the module to access the database in both function code\nfor Drupal hooks, and OO code for component-level logic without having to be\nenvironment-aware.  If the  mongodb_watchdog  module is enabled:   the  @logger.channel.foo  logger instance passed to the  Bar  constructor will\n  be a Drupal-standard  LoggerChannel  instance, dispatching events to all\n  active loggers in the site. This is the service most \"classic\" Drupal\n  applications will want to use, as it has no visible dependence on MongoDB. .  the  @mongodb.logger  logger instance passed to the  Baz  constructor will be\n  a PSR-3-standard logger only writing to MongoDB instead of logging through the\n  central Drupal logging channel mechanism, but still providing the standard\n  Drupal UI to examine the application logs. When using this service, the \n   type  option MUST be set in the message context to appear as a logging\n  channel in the Drupal logs UI. This is the service applications written in a\n  \"decoupled components\" style will prefer.  In both cases, code receiving such a logger service by dependency injection\n  should type-hint it to the PSR-3  LoggerInterface .", 
            "title": "Service-based module adapter"
        }, 
        {
            "location": "/bespoke/#component-logic", 
            "text": "Finally, the component application logic can use the services without receiving\nany Drupal-specific dependency. In this example, we can simply assume the\nservice code is located within the module itself, for simplicity:  ?php\n// modules/custom/Foo/src/Bar.php\nuse MongoDb\\Database;\nuse Psr\\Log\\LoggerInterface;\n\npublic function __construct(Database $database, LoggerInterface $logger) {\n  $this- database = $database;\n  $this- logger = $logger;\n}\n\npublic function baz() {\n  // Perform some business logic using $this- database.\n  // Log it using $this- logger.\n}  Having the code only receive standard services (like a PSR-3 logger) or PHP library  classes allows it to be written as an agnostic component that can\nbe brought in using Composer and shared with non-Drupal code. This is often\nuseful in bespoke projects, which tend to combine Drupal with other parts of the\napplication written in Laravel 5 or Symfony 4, since the code has no\nDrupal-specific dependency in that case, only exposing a PSR-3 standard API.", 
            "title": "Component logic"
        }, 
        {
            "location": "/bespoke/#tests", 
            "text": "The  mongodb  module provides a  MongoDbTestBase  base test class allowing\nkernel-based integration tests, as described on the  tests  page.", 
            "title": "Tests"
        }, 
        {
            "location": "/tests/", 
            "text": "PHPUnit\n\n\nThe newly ported modules have some test coverage, which can be checked with\nPHPUnit.\n\n\n\n\nWriting custom tests\n\n\nThe \nmongodb\n module provides a \nDrupal\\Tests\\mongodb\\Kernel\\MongoDbTestBase\n\nbase class on which to build custom kernel tests for \nbespoke\n modules, as it\nprovides a per-test database created during test \nsetUp()\n, and\ndropped during \ntearDown()\n.\n\n\nThe base class is documented on the \nmongodb\n documentation page.\n\n\nComplete test example\n\n\nThis example show how to write a test using a custom \nfoo\n database for the\neponymous module \nfoo\n, assuming individual tests do not drop the database\ninstance themselves.\n\n\n?php\n\nnamespace Drupal\\\\Tests\\foo\\Kernel;\n\nuse Drupal\\mongodb\\MongoDb;\nuse Drupal\\Tests\\mongodb\\Kernel\\MongoDbTestBase;\n\n/**\n * @coversDefaultClass \\Drupal\\foo\\Foo\n *\n * @group foo\n */\nclass FooTest extends MongoDbTestBase {\n  const MODULE = 'foo';\n\n  public static $modules = [\n    MongoDb::MODULE,\n    static::MODULE,\n  ];\n\n  /**\n   * The test database.\n   */\n  protected $database;\n\n  /**\n   * Override getSettingsArray method to include custom test database\n   */\n  public function getSettingsArray(): array {\n    $settings = parent::getSettingsArray();\n    $settings[MongoDb::MODULE]['databases']['foo_alias'] = [\n      static::CLIENT_TEST_ALIAS,\n      $this-\ngetDatabasePrefix(),\n    ];\n\n    return $settings;\n  }\n\n  /**\n   * Add a custom alias to settings and instantiate a custom database.\n   *\n   * If the tests do not need a specific database, no setUp()/tearDown() is\n   * even needed.\n   */\n  public function setUp() {\n    parent::setUp();\n    $this-\ndatabase = new DatabaseFactory(\n      new ClientFactory($this-\nsettings),\n      $this-\nsettings\n    )-\nget(static::MODULE);\n  }\n\n  /**\n   * Drop the custom database.\n   *\n   * If the tests do not need a specific database, no setUp()/tearDown() is\n   * even needed.\n   */\n  public function tearDown() {\n    $this-\ndatabase-\ndrop();\n    parent::tearDown();\n  }\n\n  /**\n   * @covers ::whatever\n   */\n  public function testWhatever() {\n    // ... custom test logic...\n  }\n\n}\n\n\n\nIn most cases, modules implementing will implement multiple classes, hence have\nmultiple tests, in which case having a per-module base test class will be\nrecommended. See \nmongodb_storage\n or \nmongodb_watchdog\n tests for examples.\n\n\nRunning tests\n\n\nNow that Simpletest is for all intents and purposes deprecated in Drupal 8.6,\nand its UI apparently going away (cf \n#2566767\n), tests should be run from the\nPHPUnit command line.\n\n\nRunning directly\n\n\nThe typical full command to run tests looks like this (\n\\\n is to avoid too long a line):\n\n\nSIMPLETEST_BASE_URL=http://localhost                \\\nBROWSERTEST_OUTPUT_DIRECTORY=/some/existing/writable/pre-existing/path \\\nSIMPLETEST_DB=mysql://user:pass@localhost/drupal8   \\\nMONGODB_URI=mongodb://somemongohost:27017           \\\nPHPUNIT_OPTS=\"-c phpunit.xml -v --debug --coverage-clover=modules/contrib/$MODULE_NAME/$COVERAGE_FILE\"\n\n\n\n\n\nFunctional tests: the \nSIMPLETEST_BASE_URL\n and \nBROWSERTEST_OUTPUT_DIRECTORY\n\n  variables are needed. Kernel and Unit tests do not need them.\n\n\nOptional: \nMONGODB_URI\n points to a working MongoDB instance. If it is not\n  provided, the tests will default to \nmongodb://localhost:27017\n.\n\n\n\n\nThese variables can also be set in the \ncore/phpunit.xml\n custom configuration\nfile to simplify the command line.\n\n\nUsing a \nphpunit.xml\n configuration file\n\n\nThe test command can also be simplified using a \nphpunit.xml\n configuration file:\n\n\nphpunit -c core/phpunit.xml\n\n\n\nOr to generate a coverage report:\n\n\nphpunit -c core/phpunit.xml --coverage-html=/some/coverage/path modules/contrib/mongodb\n\n\n\nIn this syntax, \ncore/phpunit.xml\n is a local copy of the default\n\nmongodb/core.phpunit.xml\n configuration file, tweaked for the local\nenvironment.", 
            "title": "Tests"
        }, 
        {
            "location": "/tests/#phpunit", 
            "text": "The newly ported modules have some test coverage, which can be checked with\nPHPUnit.", 
            "title": "PHPUnit"
        }, 
        {
            "location": "/tests/#writing-custom-tests", 
            "text": "The  mongodb  module provides a  Drupal\\Tests\\mongodb\\Kernel\\MongoDbTestBase \nbase class on which to build custom kernel tests for  bespoke  modules, as it\nprovides a per-test database created during test  setUp() , and\ndropped during  tearDown() .  The base class is documented on the  mongodb  documentation page.", 
            "title": "Writing custom tests"
        }, 
        {
            "location": "/tests/#complete-test-example", 
            "text": "This example show how to write a test using a custom  foo  database for the\neponymous module  foo , assuming individual tests do not drop the database\ninstance themselves.  ?php\n\nnamespace Drupal\\\\Tests\\foo\\Kernel;\n\nuse Drupal\\mongodb\\MongoDb;\nuse Drupal\\Tests\\mongodb\\Kernel\\MongoDbTestBase;\n\n/**\n * @coversDefaultClass \\Drupal\\foo\\Foo\n *\n * @group foo\n */\nclass FooTest extends MongoDbTestBase {\n  const MODULE = 'foo';\n\n  public static $modules = [\n    MongoDb::MODULE,\n    static::MODULE,\n  ];\n\n  /**\n   * The test database.\n   */\n  protected $database;\n\n  /**\n   * Override getSettingsArray method to include custom test database\n   */\n  public function getSettingsArray(): array {\n    $settings = parent::getSettingsArray();\n    $settings[MongoDb::MODULE]['databases']['foo_alias'] = [\n      static::CLIENT_TEST_ALIAS,\n      $this- getDatabasePrefix(),\n    ];\n\n    return $settings;\n  }\n\n  /**\n   * Add a custom alias to settings and instantiate a custom database.\n   *\n   * If the tests do not need a specific database, no setUp()/tearDown() is\n   * even needed.\n   */\n  public function setUp() {\n    parent::setUp();\n    $this- database = new DatabaseFactory(\n      new ClientFactory($this- settings),\n      $this- settings\n    )- get(static::MODULE);\n  }\n\n  /**\n   * Drop the custom database.\n   *\n   * If the tests do not need a specific database, no setUp()/tearDown() is\n   * even needed.\n   */\n  public function tearDown() {\n    $this- database- drop();\n    parent::tearDown();\n  }\n\n  /**\n   * @covers ::whatever\n   */\n  public function testWhatever() {\n    // ... custom test logic...\n  }\n\n}  In most cases, modules implementing will implement multiple classes, hence have\nmultiple tests, in which case having a per-module base test class will be\nrecommended. See  mongodb_storage  or  mongodb_watchdog  tests for examples.", 
            "title": "Complete test example"
        }, 
        {
            "location": "/tests/#running-tests", 
            "text": "Now that Simpletest is for all intents and purposes deprecated in Drupal 8.6,\nand its UI apparently going away (cf  #2566767 ), tests should be run from the\nPHPUnit command line.", 
            "title": "Running tests"
        }, 
        {
            "location": "/tests/#running-directly", 
            "text": "The typical full command to run tests looks like this ( \\  is to avoid too long a line):  SIMPLETEST_BASE_URL=http://localhost                \\\nBROWSERTEST_OUTPUT_DIRECTORY=/some/existing/writable/pre-existing/path \\\nSIMPLETEST_DB=mysql://user:pass@localhost/drupal8   \\\nMONGODB_URI=mongodb://somemongohost:27017           \\\nPHPUNIT_OPTS=\"-c phpunit.xml -v --debug --coverage-clover=modules/contrib/$MODULE_NAME/$COVERAGE_FILE\"   Functional tests: the  SIMPLETEST_BASE_URL  and  BROWSERTEST_OUTPUT_DIRECTORY \n  variables are needed. Kernel and Unit tests do not need them.  Optional:  MONGODB_URI  points to a working MongoDB instance. If it is not\n  provided, the tests will default to  mongodb://localhost:27017 .   These variables can also be set in the  core/phpunit.xml  custom configuration\nfile to simplify the command line.", 
            "title": "Running directly"
        }, 
        {
            "location": "/tests/#using-a-phpunitxml-configuration-file", 
            "text": "The test command can also be simplified using a  phpunit.xml  configuration file:  phpunit -c core/phpunit.xml  Or to generate a coverage report:  phpunit -c core/phpunit.xml --coverage-html=/some/coverage/path modules/contrib/mongodb  In this syntax,  core/phpunit.xml  is a local copy of the default mongodb/core.phpunit.xml  configuration file, tweaked for the local\nenvironment.", 
            "title": "Using a phpunit.xml configuration file"
        }
    ]
}